# Canvas API Automations

This contains various utilities for updating a Canvas course.

The canvas and canvasauto packages may be externally useful, but the core
purpose of this tool is for me to manage netacad courses.

## Netacad

Seriously, Cisco, it's 2024, make a GRPC or an API. It's not 1992. Grow up.

Since there is no fracking API for Netacad, some packages here expect a scrape
of straight up HTML, such as for swapping links for module items.

## Usage

### Synopsis

Utilities for interacting with the canvas API
and brutal sorta-automations for Netacad courses

### Options

```
      --courseID int      Specify course ID, necessary for most sub-commands
  -h, --help              help for canvas-api-automations
  -l, --logLevel string   Sets log level (fatal|error|warn|info|debug|trace) (default "info")
      --readOnly          Set to disable all non-GET http requests such as POST and PUT
```

### SEE ALSO

* [canvas-api-automations assignments](docs/canvas-api-automations_assignments.md)	 - Canvas Assignments
* [canvas-api-automations completion](docs/canvas-api-automations_completion.md)	 - Generate the autocompletion script for the specified shell
* [canvas-api-automations courses](docs/canvas-api-automations_courses.md)	 - Canvas Courses
* [canvas-api-automations docs](docs/canvas-api-automations_docs.md)	 - Generate documentation for canvas-api-automations
* [canvas-api-automations grades](docs/canvas-api-automations_grades.md)	 - sub-commands for grading
* [canvas-api-automations modules](docs/canvas-api-automations_modules.md)	 - Canvas modules
* [canvas-api-automations students](docs/canvas-api-automations_students.md)	 - Sub-command for student actions

###### Auto generated by spf13/cobra on 12-Feb-2024

## Weird Stuff

It's great that Canvas produced an API. Thanks Canvas. Pay attention Cisco.

There are, however, some crappy things about the Canvas API:

* Postman schema is written for form data instead of json payload
    * This breaks most auto-generated OpenAPI code
    * See note about custom RoundTripper below
* Data types are downright wrong in some places
    * Manually correcting auto-generated code sucks, but I had no choice
    * Some fields (such as `PointsPossible`) are generated as an int, but can be floats.
    * You may find more. You'll have to fix them. I fixed what I needed.
* Canvas wrote a GraphAPI, but didn't bother producing an SDL or providing an introspection endpoint
    * Because of this, you can't auto-generate code for their GraphAPI.. So I used the REST API

Because of this, I had to do two icky things:

1. Modify auto-generated code to correct field types (int -> float32)
1. Override the default http Transport with a custom RoundTripper

### About this RoundTripper

Basically the RoundTripper guts any PUT request Body, instead
loading it up with FormData. The OpenAPI spec leads the code generator to
believe it's producing `application/json` payload, when instead it should
be producing `application/x-www-form-urlencoded`.

What this looks like, is the code itself would have a json body such as:
```json
{
  "field_1[sub_field_1]": "someVal",
  "field_1[sub_field_2]": "otherVal"
}
```

What it SHOULD have is:
```json
{
  "field_1": {
      "sub_field_1": "someVal",
      "sub_field_2": "otherVal"
  }
}
```

Well crap. Also, for some reason Canvas doesn't even accept the second, I couldn't
even force mangle this bullshit into a map[string]any with nested fields as a
map[string]map[string]any without the thing cranking back a 400 on me.

So, I gut the request, replace it with a new one, load it up with form data,
and off to the races we go. You don't have to know this. You can just use
the package through the client. You're welcome.

The RoundTripper also sets auth, something the auto-gen code failed to accomodate.
